---
layout: default
title: "一次驗證所有欄位的重要性"
permalink: /一次驗證所有欄位的重要性/
---

## 前言
在城市或企業系統的 API 設計中，資料驗證的時機點往往被忽略，導致後續流程不得不回滾。
本文以餐廳廚師驗魚的例子作為引子，說明在軟體開發中為何應一次將所有欄位驗證完畢並給
出完整結果。

## 餐廳流程的類比
廚房與外場應各司其職，廚師應在料理前一次確認魚貨、配料和工具是否齊全，
而不是邊煮邊跑到外場詢問服務員。若在烹煮過程才檢查，一旦發現缺料便只能中止或重做。
同樣地，程式若邊寫邊驗證，缺陷往往在後續流程才暴露，造成中斷或需要回滾。

## 一次驗證的好處
- **避免半成品**：所有欄位一次檢查，才能在資料進入系統前就阻擋錯誤，避免 API 執行到
  一半才失敗。
- **回饋更明確**：集中驗證能一次回傳所有錯誤訊息，使用者不需多次提交才能知道所有問題。
- **維護交易一致性**：在複雜的商業流程中，一邊處理一邊驗證可能導致部分資料已寫入，
  卻因後續錯誤需要撤回，增加回滾成本。

## 實作建議
1. **集中驗證邏輯**：在 Controller 或 Application 層加入完整的驗證程序，例如使用
   FluentValidation 或自訂的驗證服務，在進入核心邏輯前一次檢查完畢。
2. **回傳清楚的錯誤**：將所有欄位的驗證結果整理成清單，讓前端或呼叫端一次取得所有錯
   誤資訊，減少來回溝通的成本。
3. **保持事務乾淨**：在驗證完成之前不要開始寫入任何資料庫或呼叫外部服務，確保失敗時不
   需要複雜的回滾機制。

## 結語
和廚師檢查魚貨一樣，系統在處理請求前也應該先做好萬全準備。一次驗證所有欄位能讓 API
運作更穩定，也能提升使用者體驗。若在程式中養成這樣的習慣，將能避免因為事後補救而造
成的時間與成本損失。
